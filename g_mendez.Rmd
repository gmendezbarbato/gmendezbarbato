---
title: "Medición y diseño de investigación"
subtitle: "Postulación a provisión interina de cargo Asistente G°2"
author: "Gustavo Méndez Barbato"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  xaringan::moon_reader:
    css: ["xaringan-themer.css", "estilo.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      countIncrementalSlides: false
      incremental: true
      df_print: kable  
      smaller: true
      widescreen: true
      highlightLines: true
---
class: inverse, center, middle

```{r setup, include=FALSE}
library(xaringanthemer)
library(kableExtra)
library(xaringan)
library(tidyverse)
library(data.table)
library(xaringanExtra)

style_duo_accent(primary_color = "#0E6251",
                 secondary_color = "#507786",
                 text_font_family = "Droid Serif",
                 text_font_url = "https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic",
                 header_font_google = google_font("Yanone Kaffeesatz"),
                 text_slide_number_color = "#000000")
knitr::opts_chunk$set(echo = FALSE)
options("kableExtra.html.bsTable" = T)

htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
xaringanExtra::use_scribble()
use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE
  )  
```

```{r data, include=FALSE}

# 0. LIBRERIAS ----

library(tidyverse)
library(haven)
library(forcats)
library(ggplot2)
library(plotly)

# 1. DATA ----

## 1.1 bases olas lapop ----
uru_2007 <- haven::read_dta("data_lapop/uru/uru_2007.dta") 
uru_2008 <- haven::read_dta("data_lapop/uru/uru_2008.dta") 
uru_2010 <- haven::read_dta("data_lapop/uru/uru_2010.dta") 
uru_2012 <- haven::read_dta("data_lapop/uru/uru_2012.dta")
uru_2014 <- haven::read_dta("data_lapop/uru/uru_2014.dta") 
uru_2017 <- haven::read_dta("data_lapop/uru/uru_2017.dta") 
uru_2019 <- haven::read_dta("data_lapop/uru/uru_2019.dta") 


## 1.2 selección de variables ----
# selecciono variables de interés como factores para quedarme con las etiquetas de los valores
uru_07 <- uru_2007 %>% 
          select(Q1, Q2, ED, IT1, ING4, ETID, VIC1, IDIO2, M1) %>% # selecciono variables
          drop_na () %>% # dado que es un ejercicio, elimino filas con NA
          rename_all(tolower) %>% # paso a minúsculas las variables para coincidir con bases más recientes
          rename("vic1ext" = vic1) %>% # renombro variable para coincidir con bases más recientes
          as_factor() %>% # convierto a factor todas la variables
          mutate(year = 2007)  # identifico año para unificación de base
  

uru_08 <- uru_2008 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1, idio2, m1) %>% # selecciono variables
  drop_na () %>% # dado que es un ejercicio, elimino filas con NA
  rename("vic1ext" = vic1) %>% # renombro variable para coincidir con bases más recientes
  as_factor() %>%  # convierto a factor todas la variables
  mutate(year = 2008) # identifico año para unificación de base

uru_10 <- uru_2010 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
  drop_na () %>% # dado que es un ejercicio, elimino filas con NA
  as_factor() %>% # convierto a factor todas la variables
  mutate(year = 2010) # identifico año para unificación de base


uru_12 <- uru_2012 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
  drop_na () %>% # dado que es un ejercicio, elimino filas con NA
  as_factor() %>%  # convierto a factor todas la variables
  mutate(q2 = haven::as_factor(q2)) %>% # fuerzo conversión a factor
  mutate(year = 2012) # identifico año para unificación de base

sum(is.na(uru_12))

uru_14 <- uru_2014 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
         drop_na () %>% # dado que es un ejercicio, elimino filas con NA
         as_factor() %>%  # convierto a factor todas la variables
         mutate(q2 = haven::as_factor(q2)) %>% # fuerzo conversión a factor
         mutate(year = 2014) # identifico año para unificación de base

uru_17 <- uru_2017 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
  drop_na () %>% # dado que es un ejercicio, elimino filas con NA
  as_factor()  %>% # convierto a factor todas la variables
  mutate(q2 = haven::as_factor(q2)) %>% # fuerzo conversión a factor
  mutate(year = 2017) # identifico año para unificación de base

uru_19 <- uru_2019 %>% 
  select(q1, q2, ed, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
  drop_na () %>% # dado que es un ejercicio, elimino filas con NA
  as_factor()  %>% # convierto a factor todas la variables
  mutate(q2 = haven::as_factor(q2)) %>% # fuerzo conversión a factor
  mutate(year = 2019) # identifico año para unificación de base

# uru_21 <- uru_2021 %>% 
#   select(q1tb, q2, edr, it1, ing4, etid, vic1ext, idio2, m1) %>% # selecciono variables
#   drop_na () %>% # dado que es un ejercicio, elimino filas con NA
#   rename("q1" = q1tb) %>% # renombro variable para coincidir con bases más recientes
#   as_factor()  %>% # convierto a factor todas la variables
#   mutate(q2 = haven::as_factor(q2)) %>% # fuerzo conversión a factor
#   mutate(year = 2021) # identifico año para unificación de base

# unifico base
data_uru <- dplyr::bind_rows(uru_07, uru_08, uru_10, uru_12, uru_14, uru_17, uru_19) 

# elimino objetos y dejo solo la base que voy a usar
rm(list=setdiff(ls(), "data_uru"))

# 2. LIMPIEZA ----

# elimino niveles no usados
data_uru <- droplevels(data_uru) 

## 2.1 Variable dependiente ----

### 2.1.1 variable ing4 (apoyo_democracia_fct) ----
levels(data_uru$ing4) # niveles
# recodifico x idioma
data_uru$ing4 <- fct_recode(data_uru$ing4, 
                            `Muy en desacuerdo` = "1 Muy en desacuerdo", 
                            `Muy en desacuerdo` = "Strongly Disagree", 
                            "2" = "( 2 )",
                            "3" = "( 3 )",
                            "4" = "( 4 )",
                            "5" = "( 5 )",
                            "6" = "( 6 )",
                            `Muy de acuerdo` = "7 Muy de acuerdo",
                            `Muy de acuerdo` = "Strongly Agree") 
# chequeo con tidy
count(data_uru, ing4)

### 2.1.2 variable ing4_num (apoyo_democracia_num) ----
# creo ing4_num como numerica porque es la variable dependiente en la regresion
data_uru$ing4_num <- as.numeric(data_uru$ing4)
# chequeo con tidy
count(data_uru, ing4_num )

# chequeo que este ok el pasaje a numerica cruzando con la var fct
data_uru %>% 
  count(ing4, ing4_num) %>% 
  spread(ing4_num, n)

### 2.1.3 variable ing4_bin (apoyo_democracia_bin) ----
# creo ing4_num como binaria
data_uru <-  data_uru %>% 
  mutate(ing4_bin = factor(case_when(# elimino var de origen para simplificar base
    ing4_num %in% c(0:5) ~ "No apoyo",
    ing4_num %in% c(6:7) ~ "Apoyo",
  ),
  levels = c("No apoyo", "Apoyo")))
# chequeo con tidy
count(data_uru, ing4_bin)

# chequeo que este ok el pasaje a numerica cruzando con la var fct
data_uru %>% 
  count(ing4, ing4_num) %>% 
  spread(ing4_num, n)


## 2.2 Variables independientes ----


### 2.2.1 variable q1 (sexo)----
levels(data_uru$q1) # niveles
# recodifico x idioma
data_uru$q1 <- fct_recode(data_uru$q1, Hombre = "Male", Mujer = "Female") 
# chequeo con R base
table(data_uru$q1)


### 2.2.2 variable q2 (edad) ----
levels(data_uru$q2) # niveles
# chequeo 
table(data_uru$q2) 

# creo una nueva variable g2 (edad_grupos)
data_uru <- data_uru %>%
  mutate(q2_grupos = factor(case_when(# elimino var de origen para simplificar base
  q2 %in% c(18:25) ~ "18-25",
  q2 %in% c(26:35) ~ "26-35",
  q2 %in% c(36:45) ~ "36-45",
  q2 %in% c(46:55) ~ "46-55",
  q2 %in% c(56:65) ~ "56-65",
  q2 %in% c(66:150) ~ "66 y más",
),
levels = c("18-25", "26-35", "36-45", "46-55", "56-65", "66 y más")))


### 2.2.3 variable ed (nivel_educ) ----
levels(data_uru$ed) # niveles
# chequeo con R base
table(data_uru$ed)
# muchos niveles, convierto a numerica y recodifico
data_uru <- data_uru %>%
  mutate(ed = as.numeric(ed)) %>% 
  mutate(ed = factor(case_when(# elimino var de origen para simplificar base
    ed %in% c(1:6) ~ "Primaria",
    ed %in% c(7:12) ~ "Secundaria",
    ed %in% c(13:100) ~ "Terciaria",
  ),
  levels = c("Primaria", "Secundaria", "Terciaria")))

### 2.2.4 variable etid (etnia_raza) ----
levels(data_uru$etid) # niveles
# recodifico x idioma
data_uru$etid <- fct_recode(data_uru$etid, 
                            Blanca = "White", 
                            Indigena = "Indigenous", 
                            Indigena = "Indígena", 
                            Otra = "Other",
                            `Negra (afrouruguaya)` = "Negra (agrouruguaya)",
                            `Negra (afrouruguaya)` = "Negra",
                            `Negra (afrouruguaya)` = "Black", 
                            Mulata = "Mulatto", 
                            Mestiza = "Mestizo")
# chequeo con tidy
count(data_uru, etid)

### 2.2.5 variable it1 (conf_interpersonal) ----
levels(data_uru$it1) # niveles
# recodifico x idioma
data_uru$it1 <- fct_recode(data_uru$it1,  
                           `Nada confiable` = "Untrustworthy", 
                           `Poco confiable` = "Not Very Trustworthy", 
                           `Algo confiable` = "Somewhat Trustworthy",
                           `Muy confiable` = "Very Trustworthy")
# chequeo con R base
table(data_uru$it1)

### 2.2.6 variable vic1ext (victima_delito) ----
levels(data_uru$vic1ext) # niveles
# recodifico x idioma
data_uru$vic1ext <- fct_recode(data_uru$vic1ext, 
                            Si = "Sí", 
                            Si = "Yes")
# chequeo con tidy
count(data_uru, vic1ext)

### 2.2.7 variable idio2 (sit_economica) ----
levels(data_uru$idio2) # niveles
# recodifico x idioma
data_uru$idio2 <- fct_recode(data_uru$idio2, 
                             Mejor = "Better", 
                             Igual = "Same",
                             Peor = "Worse")
# chequeo con tidy
count(data_uru, idio2)

### 2.2.8 variable m1 (eval_gobierno) ----
levels(data_uru$m1) # niveles
# recodifico x idioma
data_uru$m1 <- fct_recode(data_uru$m1, 
                          `Muy bueno` = "Very Good", 
                           Bueno = "Good", 
                          `Ni bueno, ni malo` = "Neither Good nor Bad (Fair)", 
                          `Ni bueno, ni malo` = "Ni bueno ni malo", 
                          `Ni bueno, ni malo` = "Ni bueno ni malo (regular)", 
                           Malo = "Bad",
                          `Muy malo` = "Muy malo (pésimo)",
                          `Muy malo` = "Very Bad")

### 2.2.9 variable year (año) ----
# chequeo con tidy
count(data_uru, year)


# 3. RENOMBRO VARIABLES ----

data_uru <- data_uru %>% 
            rename(
             "sexo" = q1,
             "edad" = q2,
             "edad_grupos" = q2_grupos,
             "nivel_educ" = ed,
             "conf_interpersonal" = it1,
             "apoyo_democracia_fct" = ing4,
             "apoyo_democracia_num" = ing4_num,
             "apoyo_democracia_bin" = ing4_bin,
             "etnia_raza" = etid,
             "victima_delito" = vic1ext,
             "sit_economica" = idio2,
             "eval_gobierno" = m1,
             "año" = year)

```

# Objetivo y Advertencia

---
## Objetivo

- Esta presentación tiene el objetivo de demostrar el manejo de la elaboración de presentaciones html en Rmarkdown para utilizar en las clases de laboratorio del curso. 

- El contenido de la presentación es una síntesis de la parte A de la prueba presentada en la postulación sobre los determinantes del apoyo a la democracia y la acompaña como anexo.

- El enfoque es centrado en la utilidad y funcionalidad para la enseñanza y no en la robustez formal del análisis, que tiene una finalidad ilustrativa.


## Advertencia

- Toma como base las presentaciones del curso Medición y Diseño de Investigación 2023, disponible en [github de Martín Opertti](https://github.com/martinopertti/Laboratorio), docente del curso.


---

## Apoyo a la democracia en Uruguay 2007-2019

- ¿Cuáles son los factores determinantes de apoyo a la democracia en Uruguay?

- Literatura señala algunas claves: 
  - evaluación del gobierno
  - situación económica
  - confianza interpersonal
  - sufrimiento de delitos recientes
  - variables socio demográficas (sexo, edad, ascendencia étnico-racial, nivel educativo)
  
- Intentaremos aproximarnos a responder estas preguntas

---

## Apoyo a la democracia en Uruguay 2007-2019

- ¿Cuáles son los factores determinantes de apoyo a la democracia en Uruguay?

- Literatura señala algunas claves: 
  - evaluación del gobierno
  - situación económica
  - confianza interpersonal
  - sufrimiento de delitos recientes
  - variables socio demográficas (sexo, edad, ascendencia étnico-racial, nivel educativo)
  
- Intentaremos aproximarnos a responder estas preguntas

---

class: inverse, center, middle

# Datos

---

## Datos

- Los datos provienen de las olas de la encuesta LAPOP de Uruguay de los años 2007, 2008, 2010, 2012, 2014, 2017 y 2019.

- Están libremente disponibles en [The Americas Barometer by the LAPOP Lab,  www.vanderbilt.edu/lapop](www.vanderbilt.edu/lapop)

.codefont[
```{r bases, echo=TRUE, eval=FALSE}

# 0. LIBRERIAS ----

library(tidyverse)
library(haven)
library(forcats)
library(ggplot2)
library(plotly)

# 1. DATA ----

## 1.1 bases olas lapop ----
uru_2007 <- haven::read_dta("data_lapop/uru/uru_2007.dta") 
uru_2008 <- haven::read_dta("data_lapop/uru/uru_2008.dta") 
uru_2010 <- haven::read_dta("data_lapop/uru/uru_2010.dta") 
uru_2012 <- haven::read_dta("data_lapop/uru/uru_2012.dta")
uru_2014 <- haven::read_dta("data_lapop/uru/uru_2014.dta") 
uru_2017 <- haven::read_dta("data_lapop/uru/uru_2017.dta") 
uru_2019 <- haven::read_dta("data_lapop/uru/uru_2019.dta") 
```
]

---

## Datos

- Defino quedarme con las etiquetas de valores utilizando la función `as_factor`

- En algunos casos debo hacer operaciones de compatibilización de nombres de variables, ejemplo con la ola 2007:

.codefont[
```{r select, , echo=TRUE, eval=FALSE}
# 1.2 selección de variables ----
# selecciono variables de interés como factores para quedarme con las etiquetas de los valores
uru_07 <- uru_2007 %>% 
          select(Q1, Q2, ED, IT1, ING4, ETID, VIC1, IDIO2, M1) %>% # selecciono variables
          drop_na () %>% # dado que es un ejercicio, elimino filas con NA
          rename_all(tolower) %>% # paso a minúsculas las variables para coincidir con bases más recientes
          rename("vic1ext" = vic1) %>% # renombro variable para coincidir con bases más recientes
          as_factor() %>% # convierto a factor todas la variables
          mutate(year = 2007)  # identifico año para unificación de base

```
]

---

## Variables

- Cada variable de la base de LAPOP corresponde a una o más preguntas o items del cuestionario 
  - [Cuestionario 2019]()
  - [Códigos 2019]()
  
- Selecciono variables de interés para el ejercicio: 
  - ing4 _(apoyo a la democracia)_
  - q1 _(sexo)_
  - q2 _(edad)_
  - ed _(nivel educativo)_
  - etid _(ascendencia étnico-racial)_
  - it1 _(confianza interpersonal)_
  - vic1ext _(victima de delito en el útimo año)_
  - idio2 _(evolución de la situación económica personal en el último año)_
  - m1 _(evaluación del gobierno)_
  - year _(año)_

---

## Variables

- **ING4.** puede que la democracia tenga problemas, pero es mejor que cualquier otra forma de gobierno. ¿Hasta qué punto está de acuerdo o en desacuerdo con esta frase? (Tarjeta con una escalera en donde el número 1 representa “muy en desacuerdo” y el número 7 representa “muy de acuerdo”)
- **Q1**. Género [Anotar, NO pregunte]: (1) Hombre (2) Mujer
- **Q2.** ¿Cuál es su edad en años cumplidos? 
- **IT1.** ¿diría que la gente de su comunidad es muy confiable, algo confiable, poco confiable o nada confiable? (1) Muy confiable (2) Algo confiable (3) Poco confiable (4) Nada confiable 
- **VIC1EXT.** ¿ha sido usted víctima de algún acto de delincuencia en los últimos 12 meses? Es decir, ¿ha sido usted víctima de un robo, hurto, agresión, fraude, chantaje, extorsión, amenazas o algún otro tipo de acto delincuencial en los últimos 12 meses? (1) Sí (2) No 
- **IDIO2.** ¿Considera usted que su situación económica actual es mejor, igual o peor que la de hace doce meses? (1) Mejor (2) Igual (3) Peor
- **M1.** Hablando en general acerca del gobierno actual, ¿diría usted que el trabajo que está realizando el Presidente Tabaré Vázquez es...?: [Leer alternativas] (1) Muy bueno (2) Bueno (3) Ni bueno, ni malo (regular) (4) Malo (5) Muy malo (pésimo) 


---

class: inverse, center, middle

# Limpieza

---

## Limpieza de datos

- Generalmente se requieren tareas adicionales de limpieza para ajustar a los objetivos del análsis

- Esto es casi indispensable cuando trabajamos con datos de encuestas de diferentes años, ya que un pequeño cambio de nombre o codificación de una variable puede obstaculizar el análisis

- Ejemplo 1:  eliminación de casos incompletos, recodificación de variable apoyo a la democracia

.codefont[
```{r limpieza, echo = TRUE, eval=FALSE}
# 2. LIMPIEZA ----
data_uru <- droplevels(data_uru) # elimino niveles no usados

### 2.1.1 variable ing4 (apoyo_democracia_fct) ----
levels(data_uru$ing4) # niveles
# recodifico x idioma
data_uru$ing4 <- fct_recode(data_uru$ing4, 
                            `Muy en desacuerdo` = "1 Muy en desacuerdo", 
                            `Muy en desacuerdo` = "Strongly Disagree", 
                            "2" = "( 2 )",
                            "3" = "( 3 )",
                            "4" = "( 4 )",
                            "5" = "( 5 )",
                            "6" = "( 6 )",
                            `Muy de acuerdo` = "7 Muy de acuerdo",
                            `Muy de acuerdo` = "Strongly Agree") 

count(data_uru, ing4) # chequeo con tidy
```
]

---

## Limpieza de datos

- Además de la limpieza también es útil crear o modificar variables que nos puedan servir para el análisis

- La variable dependiente "Apoyo a la democracia" defino calcularla de tres maneras:
  - Como factor manteniendo las categorías iniciales de la base LAPOP (en este caso una variable ordinal) 
  - Como numérica en una escala del 1 al 7
  - Como variable binaria: apoyo (valores 5, 6 y 7 de la numérica) | no apoyo (valores 1 a 4 de la numérica)
  
- Estas operaciones nos permiten ampliar las posibilidades de análisis, simplificar, facilitar las visualizaciones y tener mayor flexibilidad a la hora de construir modelos.

---

## Renombro variables

- A veces es útil renombrar las variables para que su identificación sea más sencilla

- Ejemplo:

.codefont[
```{r rename, echo = TRUE, eval=FALSE}
# 3. RENOMBRO VARIABLES ----

data_uru <- data_uru %>% 
            rename(
             "sexo" = q1,
             "edad" = q2,
             "edad_grupos" = q2_grupos,
             "nivel_educ" = ed,
             "conf_interpersonal" = it1,
             "apoyo_democracia_fct" = ing4,
             "apoyo_democracia_num" = ing4_num,
             "apoyo_democracia_bin" = ing4_bin,
             "etnia_raza" = etid,
             "victima_delito" = vic1ext,
             "sit_economica" = idio2,
             "eval_gobierno" = m1,
             "año" = year)
             
```
]

---

## Base de datos

- Luego de la limpieza, esta es la base de datos construida para el ejercicio:

.codefont[
```{r base, echo = TRUE}
glimpse(data_uru)
```
]

---

## Base de datos: resumen

.codefont[
```{r baseres, echo = FALSE}
summary(data_uru)
```
]


---

class: inverse, center, middle

# Tabulaciones 

---

## Tablas cruzadas

- Un primer análisis descriptivo es calcular el apoyo a la democracia según las distintas categorías de las variables independientes

- Este ejercicio sencillo, permite identificar de manera simple si se observan diferencias 

- Para esto la tabulación cruzada es una buena herramienta

- En este caso realizamos construimos tablas cruzadas para la variable dependiente **Apoyo a la democracia numérica** (1 es el menor apoyo - 7 mayor apoyo) según las variables seleccionadas

---

## Tablas cruzadas: sexo

- Ejemplo de cóigo de tabla:


.codefont[
```{r t_sexo, echo = TRUE}
# 4. TABLAS CRUZADAS DE APOYO A LA DEMOCRACIA ----

## 4.1 sexo ----
t_sexo <- data_uru %>% 
  count(apoyo_democracia_num, sexo) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = sexo) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según sexo. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))
```
]

---

## Tablas cruzadas: sexo

- No parecen existir diferencias muy importantes según sexo

.codefont[
```{r p_t_sexo, echo = FALSE}
t_sexo
```
]

---

## Tablas cruzadas: grupos de edad

.codefont[
```{r t_edad, include=FALSE}
## 4.2 edad_grupos ----
t_edad_grupos <- data_uru %>% 
  count(apoyo_democracia_num, edad_grupos) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = edad_grupos) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según grupos de edad. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))         
```
]

- El apoyo a la democracia parece aumentar con la edad

.codefont[
```{r p_t_edad, echo = FALSE}
t_edad_grupos
```
]

---

## Tablas cruzadas: nivel educativo

.codefont[
```{r t_nivel_educ, include=FALSE}
## 4.3 nivel_educ ----
t_nivel_educ <- data_uru %>% 
  count(apoyo_democracia_num, nivel_educ) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = nivel_educ) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según nivel educativo. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))           
```
]


- El apoyo a la democracia parece ser mayor entre las personas que cuentan con educación terciaria


.codefont[
```{r p_t_nivel_educ, echo = FALSE}
t_nivel_educ
```
]

---

## Tablas cruzadas: ascendencia étnico-racial

.codefont[
```{r t_etnia_raza, include=FALSE}
## 4.4 etnia_raza ----
t_etnia_raza <- data_uru %>% 
  count(apoyo_democracia_num, etnia_raza) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = etnia_raza) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según ascendencia étnico-racial. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))          
```
]


- El apoyo a la democracia parece ser mayor entre las personas de ascendencia étnico-racial blanca

.codefont[
```{r p_t_etnia_raza, echo = FALSE}
t_etnia_raza
```
]

---

## Tablas cruzadas: confianza interpersonal

.codefont[
```{r t_conf_interpersonal, include=FALSE}
## 4.5 conf_interpersonal ----
t_conf_interpersonal <- data_uru %>% 
  count(apoyo_democracia_num, conf_interpersonal) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = conf_interpersonal) %>% 
  spread(apoyo_democracia_num, n)  %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según confianza interpersonal. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip")) 
```
]


- El apoyo a la democracia parece aumentar conforme aumenta la confianza interpersonal

.codefont[
```{r p_t_conf_interpersonal, echo = FALSE}
t_conf_interpersonal
```
]

---

## Tablas cruzadas: víctima de delitos en el último año

.codefont[
```{r t_victima_delito, include=FALSE}
## 4.6 victima_delito ----
t_victima_delito <- data_uru %>% 
  count(apoyo_democracia_num, victima_delito) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = victima_delito) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según si fue víctima de delitos. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))          
```
]

- No parecen existir diferencias muy importantes según el sufrimiento de delitos en el último año

.codefont[
```{r p_t_victima_delito, echo = FALSE}
t_victima_delito
```
]

---

## Tablas cruzadas: evolución de la situación económica personal

.codefont[
```{r t_sit_economica, include=FALSE}
## 4.7 sit_economica ----
t_sit_economica <- data_uru %>% 
  count(apoyo_democracia_num, sit_economica) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = sit_economica) %>% 
  spread(apoyo_democracia_num, n)  %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según evolución de situación económica personal. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))         

```
]


- El apoyo a la democracia es menor entre las personas que consideran que su situación económica personal empeoró en el último año

.codefont[
```{r p_t_sit_economica, echo = FALSE}
## 4.7 sit_economica ----
t_sit_economica
```
]

---

## Tablas cruzadas: evaluación del gobierno

.codefont[
```{r t_eval_gobierno, include=FALSE}
## 4.8 eval_gobierno ----
t_eval_gobierno <- data_uru %>% 
  count(apoyo_democracia_num, eval_gobierno) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = eval_gobierno) %>% 
  spread(apoyo_democracia_num, n) %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según evaluación de gobierno. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))
```
]


- El apoyo a la democracia aumenta entre las personas que tienen evaluación más positiva del gobierno


.codefont[
```{r p_t_eval_gobierno, echo=FALSE}
t_eval_gobierno
```
]

---

## Tablas cruzadas: año

.codefont[
```{r t_año, include=FALSE}
## 4.9 año ----
t_año <- data_uru %>% 
  count(apoyo_democracia_num, año) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = año) %>% 
  spread(apoyo_democracia_num, n)  %>% 
  DT::datatable(.,
                caption = "Tabla. Apoyo a la democracia según año. Uruguay 2007-2019.", 
                options = list(searching = FALSE,
                               info = FALSE,
                               dom = "rtip"))
```
]


- El apoyo a la democracia aumentó entre 2007 y 2012

- A partir de 2014 descendió de manera importante en todas las olas


.codefont[
```{r p_t_año, echo = FALSE}
t_año
```
]

---

class: inverse, center, middle

# Gráficos 

```{r graficos, include=FALSE}

# 5. GRAFICOS DE APOYO A LA DEMOCRACIA  ----

library(ggplot2)
library(plotly)

## 4.1 sexo ----
g_sexo <- data_uru %>% 
  count(apoyo_democracia_bin, sexo) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = sexo) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=sexo, y=Apoyo, fill = sexo,
                text= paste("</br>Sexo:", sexo,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según sexo (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_sexo <- plotly::ggplotly(g_sexo, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, 
                        text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='auto', xshift=0, yshift=0,
                        font=list(size=10)))


## 4.2 edad_grupos ----
g_edad_grupos <- data_uru %>% 
  count(apoyo_democracia_bin, edad_grupos) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = edad_grupos) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=edad_grupos, y=Apoyo, fill = edad_grupos,
                text= paste("</br>Grupos de edad:", edad_grupos,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +# scale_fill_manual(
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según grupos de edad (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_edad_grupos <- plotly::ggplotly(g_edad_grupos, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
           list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                font=list(size=10)))
         
## 4.3 nivel_educ ----
g_nivel_educ <- data_uru %>% 
  count(apoyo_democracia_bin, nivel_educ) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = nivel_educ) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=nivel_educ, y=Apoyo, fill = nivel_educ,
                text= paste("</br>Nivel educativo:", nivel_educ,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según nivel educativo (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_nivel_educ <- plotly::ggplotly(g_nivel_educ, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))   

## 4.4 etnia_raza ----
g_etnia_raza <- data_uru %>% 
  count(apoyo_democracia_bin, etnia_raza) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = etnia_raza) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=etnia_raza, y=Apoyo, fill = etnia_raza,
                text= paste("</br>Ascendencia étnico racial:", etnia_raza,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según ascendencia étnico racial (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_etnia_raza <- plotly::ggplotly(g_etnia_raza, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))   


## 4.5 conf_interpersonal ----
g_conf_interpersonal <- data_uru %>% 
  count(apoyo_democracia_bin, conf_interpersonal) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = conf_interpersonal) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=conf_interpersonal, y=Apoyo, fill = conf_interpersonal,
                text= paste("</br>Confianza interpersonal:", conf_interpersonal,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según confianza interpersonal (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_conf_interpersonal <- plotly::ggplotly(g_conf_interpersonal, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))   

## 4.6 victima_delito ----
g_victima_delito <- data_uru %>% 
  count(apoyo_democracia_bin, victima_delito) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = victima_delito) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=victima_delito, y=Apoyo, fill = victima_delito,
                text= paste("</br>Victima de delitos:", victima_delito,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según si la persona fue víctima de delito en el último año (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(  plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_victima_delito <- plotly::ggplotly(g_victima_delito, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))   


## 4.7 sit_economica ----
g_sit_economica <- data_uru %>% 
  count(apoyo_democracia_bin, sit_economica) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = sit_economica) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=sit_economica, y=Apoyo, fill = sit_economica,
                text= paste("</br>Situación económica:", sit_economica,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según evolución de la situación económica (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(  plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_sit_economica <- plotly::ggplotly(g_sit_economica, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))  

## 4.8 eval_gobierno ----
g_eval_gobierno <- data_uru %>% 
  count(apoyo_democracia_bin, eval_gobierno) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = eval_gobierno) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=eval_gobierno, y=Apoyo, fill = eval_gobierno,
                text= paste("</br>Evaluación del gobierno:", eval_gobierno,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según evaluación del gobierno (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(  plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_eval_gobierno <- plotly::ggplotly(g_eval_gobierno, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10)))  


## 4.9 año ----
g_año <- data_uru %>% 
  count(apoyo_democracia_bin, año) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = año) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=as.factor(año), y=Apoyo, fill = as.factor(año),
                text= paste("</br>Año:", as.factor(año),"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según año de ola de Lapop (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(  plot.caption.position = "panel") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_año <- plotly::ggplotly(g_año, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                        font=list(size=10))) 
```

---

## Gráficos

- Además del análisis tabular, la visualización gráfica es una herramienta importante de análisis

- Las visualizaciones no son sólo para presentar resultados, son una herramienta importante de exploración de los datos y a veces pueden revelar información que no se identifica rápidamente en una tabla

- En este caso realizamos gráficos de la variable dependiente **Apoyo a la democracia binaria** (Apoyo | No apoyo) según las variables seleccionadas

---

## Gráficos: sexo

- Ejemplo de código de gráfico

.codefont[
```{r g_sexo, echo = TRUE, warning=FALSE, message=FALSE}
## 4.1 sexo ----
g_sexo <- data_uru %>% 
  count(apoyo_democracia_bin, sexo) %>% 
  mutate(n = round((n/sum(n)*100),2), .by = sexo) %>% 
  spread(apoyo_democracia_bin, n) %>% 
  ggplot(., aes(x=sexo, y=Apoyo, fill = sexo,
                text= paste("</br>Sexo:", sexo,"</br>Apoyo a la democracia:", paste0(Apoyo),"%"))) +
  geom_col(width = 0.5, color = "black", size = 0.3) +
  scale_fill_brewer(palette = "Pastel1") +
  ylim(0, NA) +
  ggtitle("Apoyo a la democracia según sexo (Uruguay 2007-2019)") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())

#grafico interactivo con plotly
g_sexo <- plotly::ggplotly(g_sexo, hoverinfo = 'text',tooltip = c("text")) %>% 
  plotly::layout(annotations = 
                   list(x = 1, y = -0.1, 
                        text = "Fuente: The Americas Barometer by the LAPOP Lab www.vanderbilt.edu/lapop", 
                        showarrow = F, xref='paper', yref='paper', 
                        xanchor='right', yanchor='auto', xshift=0, yshift=0,
                        font=list(size=10)))
```
]

---

## Gráficos: sexo

- No parecen existir diferencias muy importantes según sexo

.codefont[
```{r p_g_sexo, echo = FALSE, fig.width=10,fig.height=6.5}
g_sexo
```
]

---

## Gráficos: grupos de edad

- El apoyo a la democracia aumenta con la edad

.codefont[
```{r p_g_edad_grupos, echo = FALSE, fig.width=10,fig.height=6.5}
g_edad_grupos
```
]

---

## Gráficos: nivel educativo

- El apoyo a la democracia es mayor entre las personas con educación terciaria

.codefont[
```{r p_g_nivel_educ, echo = FALSE, fig.width=10,fig.height=6.5}
g_nivel_educ
```
]

---

## Gráficos: ascendencia étnico-racial

- El apoyo a la democracia parece ser mayor entre las personas de ascendencia étnico-racial blanca

.codefont[
```{r p_g_etnia_raza, echo = FALSE, fig.width=10,fig.height=6.5}
g_etnia_raza
```
]

---

## Gráficos: confianza interpersonal

- El apoyo a la democracia parece aumentar conforme aumenta la confianza interpersonal

.codefont[
```{r p_g_conf_interpersonal, echo = FALSE, fig.width=10,fig.height=6.5}
g_conf_interpersonal
```
]

---

## Gráficos: víctima de delitos en el último año

- No parecen existir diferencias muy importantes según el sufrimiento de delitos en el último año

.codefont[
```{r p_g_victima_delito, echo = FALSE, fig.width=10,fig.height=6.5}
g_victima_delito
```
]

---

## Gráficos: evolución de la situación económica personal

- El apoyo a la democracia es menor entre las personas que consideran que su situación económica personal empeoró en el último año

.codefont[
```{r p_g_sit_economica, echo = FALSE, fig.width=10,fig.height=6.5}
g_sit_economica
```
]

---

## Gráficos: evaluación del gobierno

- El apoyo a la democracia aumenta de forma importante entre las personas que tienen evaluación más positiva del gobierno

.codefont[
```{r p_g_eval_gobierno, echo = FALSE, fig.width=10,fig.height=6.5}
g_eval_gobierno
```
]

---

## Gráficos: año

- No parecen existir diferencias muy importantes según sexo

.codefont[
```{r p_g_año, echo = FALSE, fig.width=10,fig.height=6.5}
g_año
```
]

---


class: inverse, center, middle

# Modelos

---

## Modelos

- El análisis de las tablas cruzadas (con la variable dependiente numérica) y de los gráficos (con variable dependiente dicotomizada) dan algunas pistas sobre los factores que influyen en el apoyo a la democracia en Uruguay en el período 2007-2019

- A primera vista, los resultados parecen consistentes con la literatura reciente, con alguna excepción, como la aparente poca influencia de haber sufrido delitos en el último año.

- Una buena forma de corroborar estos indicios, es estimar modelos de regresión

- A modo de ejemplo, y sin cotejar que se cumplan los supuestos necesarios de cada modelo, se estima un modelo de regresión lineal simple, un modelo de regresión lineal múltiple y un modelo probit

---

## Regresión lineal simple: apoyo a la democracia y evaluación del gobierno

- De acuerdo a la literatura y al análisis previo, una de las variables más influyentes en el apoyo a la democracia es la evaluación del gobierno

- Cuanto mejor es la evaluación del gobierno, mayor es el apoyo a la democracia

- Estimamos una regresión lineal simple para corroborarlo

- Primero chequeamos que la variable dependiente sea continua como requiere una regresión lineal el tipo de variable (usemos la función `class()`)

.codefont[
```{r chequeo, echo = TRUE, warning = FALSE, message=FALSE}
class(data_uru$apoyo_democracia_num)
```
]

---

## Regresión lineal simple: apoyo a la democracia y evaluación del gobierno

- Utilizamos la función `lm()` para estimar el modelo de regresión lineal simple y `summary()` para ver los resultados


.codefontchico[
```{r reg1, echo = TRUE, warning = FALSE, message=FALSE}
reg <- lm(apoyo_democracia_num ~ eval_gobierno, data = data_uru)

summary(reg) # imprimo resultados
```
]

---

## Regresión lineal simple: apoyo a la democracia y evaluación del gobierno

- Utilizamos el paquete **broom** para una presentación más ordenada de los resultados

- Más allá de las limitaciones del análisis, se confirma que la relación entre evaluación de gobierno y apoyo a la democracia es estadísticamente significativa y en la dirección predicha

.codefontchico[
```{r reg1_broom, echo = TRUE, warning = FALSE, message=FALSE}
library(broom)
coef <- tidy(reg, conf.int = TRUE) 
print(coef)
```
]

---

## Regresión lineal simple: apoyo a la democracia y evaluación del gobierno

Grafico simple a partir del promedio de apoyo según evaluación del gboierno

.codefont[
```{r reg1_grafico, message=FALSE, warning=FALSE, include=FALSE}

data_grafico <- data_uru %>%
  group_by(eval_gobierno) %>%
  summarise(apoyo_democracia_num_prom = mean(apoyo_democracia_num), n = n())

g <- ggplot(data_grafico, aes(x = desc(eval_gobierno), y = apoyo_democracia_num_prom)) +
  geom_point(size = 2) +
  ggtitle("Promedio de apoyo a la democracia según evaluación del gobierno (Uruguay 2007-2019)") +
  theme_minimal() +
  geom_smooth(method = "lm", se = TRUE, color = "#138D75") +
  labs(x = "Promedio de evaluación del gobierno",
       y = "Apoyo a la democracia",
       caption = "Fuente: Elaboración propia en base a LAPOP") +
  scale_x_continuous(label = c("Muy malo", "Malo", "Ni bueno, ni malo", "Bueno", "Muy bueno")) 

```
]

.codefont[
```{r p_reg1_grafico, echo=FALSE, fig.height=6.5, fig.width=10, warning=FALSE, message=FALSE}
g
```
]
---

## Regresión lineal multiple

- Incluimos todas las variables de interés para estimar su influencia

- Con todas las variables incluidas en el modelo se mantiene la significación estadística de la evaluación del gobierno

- Además se identifican otro conjunto de variables significativas, más allá de que la varianza explicada por el modelo (aún con las limitaciones ya señaladas) es relativamente baja

.codefontchico[
```{r reg2, echo = TRUE, warning = FALSE, message=FALSE}
reg2 <- lm(apoyo_democracia_num ~ eval_gobierno + sit_economica + conf_interpersonal + victima_delito + as.numeric(año) + as.numeric(edad) + sexo + nivel_educ + etnia_raza, data = data_uru)
```
]

---

## Regresión lineal multiple

.codefontmaschico[
```{r reg2b, echo = FALSE, warning = FALSE, message=FALSE}
summary(reg2) # imprimo resultados
```
]

---

## Regresión lineal multiple

.codefontchico[
```{r reg2_broom, echo = FALSE, warning = FALSE, message=FALSE}
library(broom)
print(tidy(reg2, conf.int = TRUE), n = 40)

```
]

---

## Modelo probit

- Incluimos las variables significativas para ver su impacto en la probabilidad de Apoyo a la democracia (variable binaria)

- La evaluación del gobierno también es una variable significativa para predecir el apoyo o no apoyo a la democracia, junto con otras de las variables ya identificadas en la regresión lineal múltiple

.codefontchico[
```{r reg3, echo = TRUE, warning = FALSE, message=FALSE}
reg3 <- glm(apoyo_democracia_bin ~ eval_gobierno + sit_economica + conf_interpersonal + as.numeric(año) + as.numeric(edad) + nivel_educ + etnia_raza, family=binomial(link="probit"), data = data_uru)
```
]

---
## Modelo probit

.codefontmaschico[
```{r reg3b, echo = FALSE, warning = FALSE, message=FALSE}
summary(reg3) # imprimo resultados
```
]

---

## Modelo probit

.codefontchico[
```{r reg3_broom, echo = FALSE, warning = FALSE, message=FALSE}
library(broom)
print(tidy(reg3, conf.int = TRUE), n = 40)

```
]
